(function(a){a.fn.simplyCountable=function(c){c=a.extend({counter:"#counter",countType:"characters",maxCount:140,strictMax:false,countDirection:"down",safeClass:"safe",overClass:"over",thousandSeparator:",",onOverCount:function(){},onSafeCount:function(){},onMaxCount:function(){}},c);var b=[33,34,35,36,37,38,39,40];return a(this).each(function(){var f=a(this);var e=a(c.counter);if(!e.length){return false}var d=function(){var m;var l;var i=function(o){return o-(o*2)+c.maxCount};var n=function(){return(c.countDirection==="up")?l:m};var g=function(p){var q="";if(c.thousandSeparator){p=p.toString();if(p.match(/^-/)){p=p.substr(1);q="-"}for(var o=p.length-3;o>0;o-=3){p=p.substr(0,o)+c.thousandSeparator+p.substr(o)}}return q+p};var h=function(o){f.val(o).trigger("change")};if(c.countType==="words"){m=c.maxCount-a.trim(f.val()).split(/\s+/).length;if(f.val()===""){m+=1}}else{m=c.maxCount-f.val().length}l=i(m);if(c.strictMax&&m<=0){var k=f.val();if(m<0){c.onMaxCount(n(),f,e)}if(c.countType==="words"){var j=k.match(new RegExp("\\s?(\\S+\\s+){"+c.maxCount+"}"));if(j){h(j[0])}}else{h(k.substring(0,c.maxCount))}m=0,l=c.maxCount}e.text(g(n()));if(!e.hasClass(c.safeClass)&&!e.hasClass(c.overClass)){if(m<0){e.addClass(c.overClass)}else{e.addClass(c.safeClass)}}else{if(m<0&&e.hasClass(c.safeClass)){e.removeClass(c.safeClass).addClass(c.overClass);c.onOverCount(n(),f,e)}else{if(m>=0&&e.hasClass(c.overClass)){e.removeClass(c.overClass).addClass(c.safeClass);c.onSafeCount(n(),f,e)}}}};d();f.on("keyup blur paste",function(g){switch(g.type){case"keyup":if(a.inArray(g.which,b)<0){d()}break;case"paste":setTimeout(d,(g.type==="paste"?5:0));break;default:d();break}})})}})(jQuery);